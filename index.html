<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="UTF-8">
    <title>KYCManager front-end</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/KYCManager_ABI.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/KYCNFT_ABI.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/bignumber.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/bn.js"></script>
     
    
    
   
    
  </head>
  <body>
    <div id="txStatus"></div>
    <input type="text" id="inputOwnerAddr" oninput="getOwnerAddr();" onporpertychange="getOwnerAddr();" placeholder="CreateKYCNFT for owner address">
    <button class="createKYCNFTButton btn">CreateKYCNFT</button><br>
    <button class="enableEthereumButton btn">Enable Ethereum</button>
    <button class="sendEthButton btn">Send Eth</button>
    <button class="updateAccumulatorButton btn">update Accumulator For Owner</button>
    <script>
      /*
        KYCManager Ownerï¼š0x892953Cb6cDC87c8aD7c4aAfb06A716CBa231D8a
      */
      
      var KYCManager;
      var KYCManagerAddress = "0x6584C3a7681c65d9b39D6561aba5458026D9AC2D";
      
      var web3js =  window.web3 ? new Web3(window.web3.currentProvider) : new Web3(new Web3.providers.HttpProvider("https://goerli.infura.io/v3/de1e8657274a494aa59476341cafc010"));;
      
     
      
      function startApp() {
        console.log(" ******  start App   ******")
        
        KYCManager = new web3js.eth.Contract(kycManagerABI, KYCManagerAddress);
        
        //test
        getOwnerOfNFTid(4).then(function(result, error) {
         if(error){
           console.log(error);
         }
         else{
           var strA = "0x0000000000000000000000000000000000000000";
           var strB = new String(result);
           if(strA == strB){
              console.log("NFT not exist!")
           }else{
              console.log("OwnerOfNFTid 4: " + JSON.stringify(result))
           }
           
         }
        });
        
        //test 
        getAccumulatorAddrOfOwner('0xE338401152596583EeC184061F504D7600B59Ea6').then(function(result, error) {
         if(error){
           console.log(error);
         }
         else{
           console.log("AccumulatorAddrOfOwner: " + JSON.stringify(result));
         }
        });
        //èŽ·å–metamaskè´¦æˆ·
        getAccount();
        

        
        
      }
      
      
    
       /********************************************************    Call Contract by web3js      **************************************************************************************/
      


      /*
      getBalance
      */
      function getBalance(address){
         web3js.eth.getBalance(address,function(error,result){
         if(error){
           console.log(error)
         }
         else{
           console.log(result)
           
         }
        }) 
      }
      
       
      
    /*
       (1) åˆ›å»ºNFTï¼ˆ owneræƒé™ï¼‰
    */
      
       function createKYCNFT(tokenUrl, manager) {
        $("#txStatus").text("Creating KYCNFT on the blockchain. This may take a while...");

        return KYCManager.methods.createKYCNFT(tokenUrl, manager)
        .send({ from: web3.eth.accounts[0]})
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully created " + tokenUrl + "for manager" + manager + "!");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
    
      }
      
      
    /*
       (2) è®¾ç½®NFTæœ‰æ•ˆæ€§
    */
       function setKYCNFTAvailable(NFTid, available) {
        $("#txStatus").text("Set KYCNFT Available This may take a while...");
        
        return KYCManager.methods.setNFTAvailable(NFTid, available)
        .send({ from: web3.eth.accounts[0]})
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully set " + NFTid + "to Available" + available + "!");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
      }
      
      
      
     /*
      ï¼ˆ3ï¼‰Map1:ç»‘å®šNFTidä¸Žç®¡ç†åœ°å€
     */
 
     //createæ˜¯owneræƒé™
       function createNFTidToManagerAddr(NFTid, manager) {
        $("#txStatus").text("Set create NFTid to ManagerAddr This may take a while...");

        return KYCManager.methods.createNFTidToManagerAddr(NFTid, manager)
        .send({ from: web3.eth.accounts[0]})
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully create NFTid " + NFTid + "to ManagerAddr" + manager + "!");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
   
 
      }  
    //modifyæ˜¯Manager addræƒé™
      function modifyNFTidToManagerAddr(NFTid, newManager) {
        $("#txStatus").text("Set modify NFTid to ManagerAddr. This may take a while...");
        
        return KYCManager.methods.modifyNFTidToManagerAddr(NFTid, newManager)
        .send({ from: web3.eth.accounts[0]})
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully modify NFTid " + NFTid + "to ManagerAddr" + newManager + "!");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
      }



    /*
      ï¼ˆ4ï¼‰Map2:ç»‘å®šç®¡ç†åœ°å€ä¸Žç´¯åŠ å™¨ï¼ˆæŸ¥è¯¢ç®¡ç†åœ°å€å·²ç»æœ‰äº†å¯¹åº”çš„KYCNFTï¼‰
    */
      function updateAccumulator(addrOfAccumulator) {
        $("#txStatus").text("Bind Manger to Accumulator. This may take a while...");
        
        return KYCManager.methods.updateAccumulator(addrOfAccumulator)
        .send({ from: web3.eth.accounts[0]})
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully update Manger " + web3.eth.accounts[0] + "to addrOfAccumulator" + addrOfAccumulator + "!");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
      }
  
  
      
      
    /*
       ï¼ˆ5ï¼‰æŸ¥è¯¢æŸNFT idå¯¹åº”çš„ç®¡ç†åœ°å€ä¸Žç´¯åŠ å™¨åœ°å€
    */
      //ç”±NFTid æ‰¾Owneråœ°å€
      function getOwnerOfNFTid(id) {
        return KYCManager.methods.ownerOfNFTid(id).call()
      }
      
       //ç”±NFTid æ‰¾Accumulatoråœ°å€
      function getAccumulatorAddrOfNFTID(id) {
        return KYCManager.methods.accumulatorAddrOfNFTID(id).call()
      }
      
      //ç”±Owner æ‰¾Accumulatoråœ°å€
      function getAccumulatorAddrOfOwner(owner) {
        return KYCManager.methods.accumulatorAddrOfOwner(owner).call()
      }
      
       //ç”±NFTidæŸ¥è¯¢æœ‰æ•ˆæ€§
      function getAvailableOfNFTid(id) {
        return KYCManager.methods.availableOfNFTid(id).call()
      }
     
     
     /********************************************************    UI      **************************************************************************************/
     
    var ownerAddr = document.getElementById("inputOwnerAddr").value;;
    function getOwnerAddr(){
	    ownerAddr = document.getElementById("inputOwnerAddr").value;
		console.log("inputOwnerAddr = " + ownerAddr);
	}



    const ethereumButton = document.querySelector('.enableEthereumButton');
    const sendEthButton = document.querySelector('.sendEthButton');
    const createKYCNFTButton = document.querySelector('.createKYCNFTButton');
    const updateAccumulatorButton = document.querySelector('.updateAccumulatorButton');
    let accounts = [];

    ethereumButton.addEventListener('click', () => {
       getAccount();
    });

    sendEthButton.addEventListener('click', () => {
       ethereum
      .request({
         method: 'eth_sendTransaction',
         params: [
         {
          from: accounts[0],
          to: '0xE338401152596583EeC184061F504D7600B59Ea6',
          value: '0x29a2241af62c0000',
          gasPrice: '0x09184e72a000',
          gas: '0x2710',
         },
       ],
       })
      .then((txHash) => console.log(txHash))
      .catch((error) => console.error);
    });
   
    async function getAccount() {
       accounts = await ethereum.request({ method: 'eth_requestAccounts' });
    }
    
   
    createKYCNFTButton.addEventListener('click', () => {
    
        
        createKYCNFT("ipfs://ipfsHash",ownerAddr).then(function(result, error) {
         if(error){
           console.log(error)
         }
         else{
           console.log("create KYCNFT Success !: " + JSON.stringify(result));
         }
        });
        
    });
    
    updateAccumulatorButton.addEventListener('click', () => {
        
        updateAccumulator(BigNumber(162259276829213363391578010288127)).then(function(result, error) {
         if(error){
           console.log(error)
         }
         else{
           console.log("update Accumulator Success !: " + JSON.stringify(result));
         }
        });
        
    });



     /*
    ***********************************************************     Metamask check      *****************************************************************************************
    
    What metamask do is inject javascript into the document when you access it. The browser will execute this javascript, and is that execution that will define de variable web3.

    But when you are accessing a document by accessing the file (your url will start with file://) then metamask will not inject the javascript, so the variable web3 will be undefined.

    Try accessing your file through a web server of some sort and it will work.
    
     */
   

    
    window.addEventListener('load', function() {

       _Connect()
      
       startApp(); 
    }) 
     
     
     
   /*
   mainnet	ETH	1	1	Production
   ropsten	ETH	3	3	Test
   rinkeby	ETH	4	4	Test
   goerli	ETH	5	5	Test
   */
    
   function _Connect(){

    if(typeof window.ethereum !== 'undefined') {
        if(web3js.currentProvider.isMetaMask){
          console.log("CurrentProvider is MetaMask");
        }else {
          console.log(`Failed: Web3 instance required, try using MetaMask.`);
          alert('Install Metamask');
        } 
       
        console.log("netId = " + web3js.currentProvider.networkVersion)
        switch (web3js.currentProvider.networkVersion) {
          case "1":
           // alert('Ethereum MainNet'); 
            console.log('Ethereum MainNet');
            break
          case "3":
           // alert('Ethereum Ropsten'); 
            console.log('Ethereum Ropsten');
            break    
          case "4":
            //alert('Ethereum Rinkeby'); 
            console.log('Ethereum Rinkeby');
            break   
          case "5":
            //alert('Ethereum Goerli'); 
            console.log('Ethereum Goerli');
            break   
            
          default:
            console.log('This is an unknown network.');
            alert('Switch Network');
        }
        web3.eth.defaultAccount = web3.eth.accounts[0];
        if(!web3.eth.defaultAccount){
            console.log('Log into metamask');
            _Connect(callback);
        }else{ 
            // Success
            console.log(`Web3 ETH Account: ${web3.eth.defaultAccount}`);
        } 
              
    }
    }
          
   
    /********************************************************    Accumulator      **************************************************************************************/
   

    function powInMod(a, y, z) {
      let x = BigNumber(1);
      while(y.comparedTo(0) == 1) {
        if(y.mod(2).toNumber() === 1) {
          x = (x.times(a)).mod(z);
          y = y.minus(1);
        }
        y = y.div(2);
        a = a.times(a).mod(z);
      }
      return x;
    }

    // should be big. And the prime factors of N should be unknown to anyone. may be too small?
    const N = new BigNumber(1073807359);
 
    class RSAaccumulator {
      
      static updateAccumulator(accumulator, value) {
        return powInMod(accumulator, value, N);
      }

      static deleteItemFromAccumulator(coins,generator,accumulator,y) {
        //shamirTrick(p1, p2, x, y, n) 
        // suppose x = 1, delete y from old accumulator c = c^1 = p2^y modn,
        // p1 = old accumulator, x = 1
        // p2 = witness of y , y ->going to be deleted
        //  returnValue^(xy) =  returnValue^(y) = c modn,
        //  then returnValue become the new accumulator câ€˜,c' do not have y
        // remember accumulator is BigNumber ,should use .toNumber() 
            let p1 = new BN(accumulator.toNumber())
            let p2 = RSAaccumulator.getProof(
                 coins,
                 y,
                 generator,
                 accumulator);
            let x = new BN(1);
            let newAccumulator = BigNumber(shamirTrick(p1, p2, x, y).toNumber())        
      }
      
      static hash(value) {
        const hash = '0x' + Web3.utils.keccak256(value.toString()).toString('hex')
        return new BigNumber(hash);
      }
      
     static getProof(setValues, value, generator, accumulator){
       // calcute (q,r,x). it satisfies q**B * g**(vr)* g**x == A
       // h = generator^value, B = hash(h+accumulator) ,
       let h = powInMod(generator, value, N);
       let B = RSAaccumulator.hash(h.plus(accumulator));
       let q = BigNumber(1);
       let r = BigNumber(0);
       let x = BigNumber(1);
       for(let i = 0; i < setValues.length; i++){
         let x2 = (x.times(setValues[i])).mod(value);
         let temp = ((x.times(setValues[i])).div(value))
                     .plus(r.times(setValues[i]))
                     .integerValue(BigNumber.ROUND_FLOOR);
         let r2 = temp.mod(B);
         let q2 = powInMod(BigNumber(1), setValues[i], N)
                   .times(powInMod(h, (temp.div(B)).integerValue(BigNumber.ROUND_FLOOR), N))
                   .mod(N);
         x = x2;
         r = r2;
         q = q2;
       }
       console.log('get proof', q.toNumber(), r.toNumber(), x.toNumber());
       return new RSAaccumulatorProof(value, q, r, x);
     }
   
     static checkNonInclusionProof(generator, accumulator, proof) {
       let h = powInMod(generator, proof.value, N);
       let B = RSAaccumulator.hash(h.plus(accumulator));
       if(proof.x.comparedTo(0) <= 0 || proof.value.comparedTo(proof.x) <= 0){
         return false;
       }
       if(proof.r.comparedTo(0) <= 0 || B.comparedTo(proof.r) <= 0){
         return false;
       }
       if(powInMod(proof.q, B, N).times(powInMod(generator, proof.r.times(proof.value).plus(proof.x), N)).mod(N).eq(accumulator)) {
         return true;
       }else{
         return false;
       }
     }

     static checkInclusionProof(generator, accumulator, proof){
       let h = powInMod(generator, proof.value, N);
       let B = RSAaccumulator.hash(h.plus(accumulator));
       if(!proof.x.eq(0)){
         return false;
       }
       if(proof.r.comparedTo(0) <= 0 || B.comparedTo(proof.r) <= 0){
         return false;
       }
       if(powInMod(proof.q, B, N).times(powInMod(generator, proof.r.times(proof.value).plus(proof.x), N)).mod(N).eq(accumulator)){
           return true;
       }else{
           return false;
       }
     }
   }

    class RSAaccumulatorProof{
         constructor(value,q,r,x){
           this.value=value;
           this.q=q;
           this.r=r;
           this.x=x;
         }
    }
    /*

    Shamir's trick: Given n,p1,p2,x,y  s.t. p1^x = p2^y modn, and x,y are relatively primes, you can efficiently find p2^(1/ð‘’)modð‘. 
    The trick is to compute integers ð‘Ž,ð‘  s.t. ð‘Ž.x + ð‘.y = 1.
    @return returnValue^(xy) = p1^x = p2^y = c modn
    how to use:
     suppose x = 1, delete y from old accumulator c = c^1 = p2^y modn,
     p1 = old accumulator, x = 1
     p2 = witness of y , y ->going to be deleted
     returnValue^(xy) =  returnValue^(y) = c modn,
     then returnValue become the new accumulator câ€˜,c' do not have y
    */

    function shamirTrick(p1, p2, x, y, n) {
      const [a, b, g] = x.egcd(y);
      var w1 = p1.pow(b).mod(n)
      var w2 = p2.pow(a).mod(n)
      return w1.mul(w2).mod(n)
    }



      
   primeNumberList = [
  5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79,

// Few numbers from
// https://primes.utm.edu/lists/small/10000.txt

  100129, 100151, 100153, 100169, 100183, 100189, 100193, 100207, 100213, 100237,
  100267, 100271, 100279, 100291, 100297, 100313, 100333, 100343, 100357, 100361,
  100363, 100379, 100391, 100393, 100403, 100411, 100417, 100447, 100459, 100469,
  100483, 100493, 100501, 100511, 100517, 100519, 100523, 100537, 100547, 100549,
  100559, 100591, 100609, 100613, 100621, 100649, 100669, 100673, 100693, 100699,
  100703, 100733, 100741, 100747, 100769, 100787, 100799, 100801, 100811, 100823,
  100829, 100847, 100853, 100907, 100913, 100927, 100931, 100937, 100943, 100957,
  100981, 100987, 100999, 101009, 101021, 101027, 101051, 101063, 101081, 101089,
  101107, 101111, 101113, 101117, 101119, 101141, 101149, 101159, 101161, 101173,
  101183, 101197, 101203, 101207, 101209, 101221, 101267, 101273, 101279, 101281,
  101287, 101293, 101323, 101333, 101341, 101347, 101359, 101363, 101377, 101383,
  101399, 101411, 101419, 101429, 101449, 101467, 101477, 101483, 101489, 101501,
  101503, 101513, 101527, 101531, 101533, 101537, 101561, 101573, 101581, 101599,
  101603, 101611, 101627, 101641, 101653, 101663, 101681, 101693, 101701, 101719,
  101723, 101737, 101741, 101747, 101749, 101771, 101789, 101797, 101807, 101833,
  101837, 101839, 101863, 101869, 101873, 101879, 101891, 101917, 101921, 101929,
  101939, 101957, 101963, 101977, 101987, 101999, 102001, 102013, 102019, 102023,
  102031, 102043, 102059, 102061, 102071, 102077, 102079, 102101, 102103, 102107,
  102121, 102139, 102149, 102161, 102181, 102191, 102197, 102199, 102203, 102217,
  102229, 102233, 102241, 102251, 102253, 102259, 102293, 102299, 102301, 102317,
  102329, 102337, 102359, 102367, 102397, 102407, 102409, 102433, 102437, 102451,
  102461, 102481, 102497, 102499, 102503, 102523, 102533, 102539, 102547, 102551,
  102559, 102563, 102587, 102593, 102607, 102611, 102643, 102647, 102653, 102667,
  102673, 102677, 102679, 102701, 102761, 102763, 102769, 102793, 102797, 102811,
  102829, 102841, 102859, 102871, 102877, 102881, 102911, 102913, 102929, 102931,
  102953, 102967, 102983, 103001, 103007, 103043, 103049, 103067, 103069, 103079,
  103087, 103091, 103093, 103099, 103123, 103141, 103171, 103177, 103183, 103217,
  103231, 103237, 103289, 103291, 103307, 103319, 103333, 103349, 103357, 103387,
  103391, 103393, 103399, 103409, 103421, 103423, 103451, 103457, 103471, 103483,
  103511, 103529, 103549, 103553, 103561, 103567, 103573, 103577, 103583, 103591,
  103613, 103619, 103643, 103651, 103657, 103669, 103681, 103687, 103699, 103703,
  103723, 103769, 103787, 103801, 103811, 103813, 103837, 103841, 103843, 103867,
  103889, 103903, 103913, 103919, 103951, 103963, 103967, 103969, 103979, 103981,
  103991, 103993, 103997, 104003, 104009, 104021, 104033, 104047, 104053, 104059,
  104087, 104089, 104107, 104113, 104119, 104123, 104147, 104149, 104161, 104173,
  104179, 104183, 104207, 104231, 104233, 104239, 104243, 104281, 104287, 104297,
  104309, 104311, 104323, 104327, 104347, 104369, 104381, 104383, 104393, 104399,
  104417, 104459, 104471, 104473, 104479, 104491, 104513, 104527, 104537, 104543,
  104549, 104551, 104561, 104579, 104593, 104597, 104623, 104639, 104651, 104659,
  104677, 104681, 104683, 104693, 104701, 104707, 104711, 104717, 104723, 104729,

  // Few of the largest primes found here
  // https://primes.utm.edu/lists/small/millions/

  982447957, 982448011, 982448017, 982448023, 982448069, 982448081, 982448083, 982448099,
  982448101, 982448147, 982448153, 982448177, 982448179, 982448209, 982448221, 982448239,
  982448263, 982448267, 982448279, 982448321, 982448347, 982448393, 982448413, 982448429,
  982448491, 982448539, 982448557, 982448587, 982448591, 982448609, 982448617, 982448627,
  982448629, 982448647, 982448699, 982448723, 982448741, 982448743, 982448767, 982448833,
  982448837, 982448851, 982448867, 982448879, 982448881, 982448893, 982448899, 982448923,
  982448953, 982448959, 982449001, 982449031, 982449053, 982449059, 982449067, 982449107,
  982449109, 982449113, 982449121, 982449133, 982449137, 982449229, 982449239, 982449277,
  982449313, 982449343, 982449361, 982449371, 982449379, 982449401, 982449409, 982449437,
  982449449, 982449463, 982449487, 982449491, 982449539, 982449553, 982449557, 982449563,
  982449569, 982449571, 982449581, 982449607, 982449619, 982449631, 982449647, 982449653,
  982449673, 982449679, 982449683, 982449691, 982449707, 982449731, 982449751, 982449757,
  982449763, 982449773, 982449847, 982449851, 982449869, 982449889, 982449901, 982449943,
  982449961, 982449983, 982449989, 982449997, 982450003, 982450031, 982450039, 982450057,
  982450069, 982450087, 982450093, 982450097, 982450121, 982450151, 982450177, 982450187,
  982450199, 982450207, 982450223, 982450253, 982450289, 982450291, 982450303, 982450319,
  982450321, 982450327, 982450373, 982450411, 982450457, 982450459, 982450507, 982450523,
  982450531, 982450577, 982450583, 982450591, 982450633, 982450639, 982450649, 982450657,
  982450673, 982450687, 982450697, 982450741, 982450753, 982450769, 982450787, 982450801,
  982450829, 982450849, 982450871, 982450913, 982450921, 982450943, 982450967, 982450981,
  982450999, 982451023, 982451081, 982451087, 982451111, 982451123, 982451159, 982451161,
  982451179, 982451191, 982451219, 982451227, 982451231, 982451243, 982451321, 982451333,
  982451359, 982451383, 982451419, 982451429, 982451443, 982451467, 982451479, 982451497,
  982451501, 982451549, 982451567, 982451579, 982451581, 982451609, 982451629, 982451653
]


   
   
   function Test(){//start
 
     const coins=[
        BigNumber(primeNumberList[440]),
        BigNumber(primeNumberList[441]),
        BigNumber(primeNumberList[442]),
        BigNumber(primeNumberList[443]),
        BigNumber(primeNumberList[444]),
        BigNumber(primeNumberList[445]),
        BigNumber(primeNumberList[446]),
        BigNumber(primeNumberList[447]),
        BigNumber(primeNumberList[448]),
     ];
  
     const generator = new BigNumber(982451653);
     accumulator = generator;
     console.log("accumulator before" + accumulator)
     for(i=0; i < coins.length; i++) {
      accumulator = RSAaccumulator.updateAccumulator(accumulator, coins[i]);
      console.log("accumulator add after" + coins[i] + " is " + accumulator)
     }


     console.log("accumulator delete before " + coins[8] + " is " + accumulator)
     
     accumulator = RSAaccumulator.deleteItemFromAccumulator(coins, generator, accumulator, coins[8]);
     console.log("accumulator delete after " + coins[8] + " is " + accumulator)


     const proof = RSAaccumulator.getProof(
        coins,
        BigNumber(primeNumberList[449]),
        generator,
        accumulator);
    //[449] is not in accumulator , should be "Wrong proof"
    if(RSAaccumulator.checkInclusionProof(generator, accumulator, proof) == false){
        console.log("Wrong proof")
    }else{
        console.log("Right proof")
    }
     
     const proof2 = RSAaccumulator.getProof(
        coins,
        BigNumber(primeNumberList[447]),
        generator,
        accumulator);
        
    //[447] is  in accumulator , should be "Right proof"
    if(RSAaccumulator.checkInclusionProof(generator, accumulator, proof2) == false){
        console.log("Wrong proof")
    }else{
        console.log("Right proof")
    }

    /**** Test web3js utils ****/
    
    var BN = web3js.utils.BN
    var axxx = new BN(0xea)
    console.log("a = " + axxx)
    
    var bxxx =  web3js.utils.sha3('0xea'); // å…ˆè½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚æ•°ç»„å†è¿›è¡Œå“ˆå¸Œè¿ç®—
    //should be 0x2f20677459120677484f7104c76deb6846a2c071f9b3152c103bb12cd54d1a4a
    console.log("b = " + bxxx)
   

    /**** Test hash To Prime  ****/
    hashToPrime('0x892953Cb6cDC87c8aD7c4aAfb06A716CBa231D8a')
   

  

    }//end
 

    Test()
 
 
 //Todo: hashToPrime !!!!!!!!!!!!!!!!!!!
//see : https://crypto.stackexchange.com/questions/24514/deterministically-generate-a-rsa-public-private-key-pair-from-a-passphrase-with
//https://crypto.stackexchange.com/questions/63013/hash-to-prime-numbers
    function hashToPrime(address){
      var BN = web3js.utils.BN
      var addrToHash = web3js.utils.sha3(address)
      //æœ€å¤§åªèƒ½æ”¯æŒ52bitsï¼Œå–åœ°å€sha3åŽçš„hashå€¼å‰13ä½, åŠ ä¸Šå‰ç¼€0x 2ä½
      var addrBN = web3js.utils.hexToNumber(addrToHash.substring(0,15))
      var times = 0
      while(1){
        var isprime = probablyPrime(addrBN,10)
        if(isprime == true){
          times++;
          if(times == 10){
            console.log("find prime = ", addrBN)
            break;
          }
        }else{
          times = 0;
          var addrToHash = web3js.utils.sha3(address)
          var addrBN = BN(addrToHash)
        }
      }
    }
    /*
    Millerâ€“Rabin primality test 
    */
    function probablyPrime(n, k) {
      var BN = web3js.utils.BN;
     	if (n.eq(BN(2))  || n.eq(BN(3)) )
   		return true;
    	if (n.mod(2) === 0 || n < BN(2))
	  	return false;
 
    	//Write (n - 1) as 2^s * d
    	var s = 0, d = BN(n - 1);
    	while (d.mod(2) === 0) {
	     	d.div(2);
		    ++s;
     	}
 
   	  WitnessLoop: do {
	    	//A base between 2 and n - 2
	    	var x = Math.pow(2 + Math.floor(Math.random() * (n - 3)), d) % n;
 
	  	  if (x === 1 || x === n - 1)
		  	  continue;
 
	   	  for (var i = s - 1; i--;) {
		    	x = x * x % n;
		    	if (x === 1)
			  	 return false;
			    if (x === n - 1)
				   continue WitnessLoop;
		    }
 
	  	  return false;
	    } while (--k);
 
	    return true;
    }




  
    </script>
  </body>
</html>
 